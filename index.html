<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Управление прокатом</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        h2 { margin-top: 0; }
        
        /* Навигация (вкладки) */
        .nav { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #ddd; padding-bottom: 10px; }
        .nav button { flex: 1; padding: 10px; cursor: pointer; background: #eee; border: none; border-radius: 5px; }
        .nav button.active { background: #007bff; color: white; }

        /* Секции */
        .section { display: none; }
        .section.active { display: block; }

        /* Карточки самокатов */
        .scooter-item, .rental-item { border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; }
        .btn-start { background: #28a745; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        .btn-stop { background: #dc3545; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; }
        
        /* Настройки */
        .settings-row { margin-bottom: 15px; }
        .settings-row label { display: block; margin-bottom: 5px; }
        .settings-row input { width: 100%; padding: 8px; box-sizing: border-box; }
        .btn-save { background: #007bff; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; }

        .timer-display { font-weight: bold; font-size: 1.2em; color: #333; }
    </style>
</head>
<body>

<div class="container">
    <div class="nav">
        <button onclick="showSection('park')" class="active" id="btn-park">Парк</button>
        <button onclick="showSection('active')" id="btn-active">Аренды</button>
        <button onclick="showSection('settings')" id="btn-settings">Настройки</button>
    </div>

    <div id="park" class="section active">
        <h2>Доступные самокаты</h2>
        <div id="scooter-list">
            </div>
    </div>

    <div id="active" class="section">
        <h2>Текущие поездки</h2>
        <div id="active-rentals">
            <p>Нет активных поездок</p>
        </div>
    </div>

    <div id="settings" class="section">
        <h2>Настройки</h2>
        <div class="settings-row">
            <label>Цена за минуту (руб):</label>
            <input type="number" id="price-per-min" value="5">
        </div>
        <button class="btn-save" onclick="saveSettings()">Сохранить настройки</button>
    </div>
</div>

<script>
    // --- ДАННЫЕ ---
    let scooters = [
        { id: 1, name: "Самокат #1", status: "free" },
        { id: 2, name: "Самокат #2", status: "free" },
        { id: 3, name: "Самокат #3", status: "free" },
        { id: 4, name: "Самокат #4", status: "free" }
    ];

    let activeRentals = []; // Здесь храним активные таймеры
    let tariff = 5; // Цена по умолчанию
    let timerInterval = null;

    // --- ПРИ ЗАГРУЗКЕ ---
    window.onload = function() {
        // Загружаем настройки если есть
        let savedTariff = localStorage.getItem('tariff');
        if (savedTariff) {
            tariff = parseFloat(savedTariff);
            document.getElementById('price-per-min').value = tariff;
        }
        renderPark();
        // Запускаем общий таймер обновления
        timerInterval = setInterval(updateTimers, 1000);
    };

    // --- НАВИГАЦИЯ ---
    function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.nav button').forEach(el => el.classList.remove('active'));
        
        document.getElementById(sectionId).classList.add('active');
        document.getElementById('btn-' + sectionId).classList.add('active');
    }

    // --- ОТРИСОВКА ПАРКА ---
    function renderPark() {
        const list = document.getElementById('scooter-list');
        list.innerHTML = '';
        scooters.forEach(scooter => {
            if (scooter.status === 'free') {
                let div = document.createElement('div');
                div.className = 'scooter-item';
                div.innerHTML = `
                    <strong>${scooter.name}</strong>
                    <button class="btn-start" onclick="startRental(${scooter.id})">Старт</button>
                `;
                list.appendChild(div);
            }
        });
    }

    // --- ОТРИСОВКА АРЕНД ---
    function renderRentals() {
        const list = document.getElementById('active-rentals');
        list.innerHTML = '';
        if (activeRentals.length === 0) {
            list.innerHTML = '<p>Нет активных поездок</p>';
            return;
        }

        activeRentals.forEach((rental, index) => {
            let now = new Date();
            let diff = Math.floor((now - rental.startTime) / 1000); // секунды
            
            // Форматируем время ММ:СС
            let minutes = Math.floor(diff / 60);
            let seconds = diff % 60;
            let timeString = (minutes < 10 ? "0" : "") + minutes + ":" + (seconds < 10 ? "0" : "") + seconds;

            // Считаем деньги
            let cost = (minutes * tariff) + (seconds > 0 ? tariff : 0); // Простой расчет (округление минуты вверх)

            let div = document.createElement('div');
            div.className = 'rental-item';
            div.innerHTML = `
                <div>
                    <strong>${rental.scooterName}</strong><br>
                    <span class="timer-display">${timeString}</span> | ${cost} руб.
                </div>
                <button class="btn-stop" onclick="stopRental(${index})">Стоп</button>
            `;
            list.appendChild(div);
        });
    }

    // --- ЛОГИКА ---
    function startRental(id) {
        let scooter = scooters.find(s => s.id === id);
        if (scooter) {
            scooter.status = 'busy'; // Убираем из парка
            activeRentals.push({
                scooterId: scooter.id,
                scooterName: scooter.name,
                startTime: new Date()
            });
            renderPark();
            renderRentals();
            showSection('active'); // Переключаем на вкладку аренд
        }
    }

    function stopRental(index) {
        let rental = activeRentals[index];
        // Возвращаем самокат в парк
        let scooter = scooters.find(s => s.id === rental.scooterId);
        if (scooter) scooter.status = 'free';

        // Удаляем из аренды
        activeRentals.splice(index, 1);
        
        renderPark();
        renderRentals();
        alert(`Поездка на ${rental.scooterName} завершена!`);
    }

    function updateTimers() {
        if (activeRentals.length > 0) {
            renderRentals();
        }
    }

    function saveSettings() {
        let val = document.getElementById('price-per-min').value;
        if (val) {
            tariff = parseFloat(val);
            localStorage.setItem('tariff', tariff);
            alert('Настройки сохранены! Тариф: ' + tariff);
        }
    }
</script>

</body>
</html>
