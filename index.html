<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Super Bot</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-color: var(--tg-theme-bg-color, #17212b);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow-x: hidden;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .message-bubble { max-width: 80%; border-radius: 12px; padding: 10px; margin-bottom: 8px; font-size: 14px; }
        .user-msg { background-color: #3390ec; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .ai-msg { background-color: #2b2b2b; color: #e4e4e4; align-self: flex-start; border-bottom-left-radius: 2px; }
        .page-enter { opacity: 0; transform: translateY(10px); animation: fadeInUp 0.3s forwards; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        
        /* –°—Ç–∏–ª—å –¥–ª—è —ç–∫—Ä–∞–Ω–∞ –æ—à–∏–±–∫–∏ */
        #error-boundary { padding: 20px; color: #ff6b6b; font-family: monospace; word-break: break-all; display: none; }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="error-boundary"></div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ö–≤–∞—Ç –æ—à–∏–±–æ–∫ (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –±–µ–ª–æ–≥–æ —ç–∫—Ä–∞–Ω–∞)
        window.onerror = function(msg, url, line, col, error) {
            document.getElementById('root').style.display = 'none';
            const errDiv = document.getElementById('error-boundary');
            errDiv.style.display = 'block';
            errDiv.innerHTML = `<h3>‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:</h3><p>${msg}</p><p>Line: ${line}</p>`;
            return false;
        };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // –í–ê–® –Æ–ó–ï–†–ù–ï–ô–ú (–±–µ–∑ @)
        const ADMIN_USERNAME = "Sani75rus"; 

        const App = () => {
            const [activeTab, setActiveTab] = useState('generate');
            // –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, —á—Ç–æ–±—ã –Ω–µ –∫—Ä–∞—à–∏–ª–æ—Å—å
            const [user, setUser] = useState({ first_name: '–ì–æ—Å—Ç—å', id: 0, username: '' });
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            const [config, setConfig] = useState({
                priceImage: 50,
                priceVideo: 300,
                priceText: 10,
                welcomeBonus: 100,
                referralReward: 50,
                friendsForReward: 1
            });

            const [tokens, setTokens] = useState(100);
            const [referrals, setReferrals] = useState(0);
            const [chatHistory, setChatHistory] = useState([
                { role: 'ai', text: '–ü—Ä–∏–≤–µ—Ç! –Ø Grok AI. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?' }
            ]);

            // --- –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• ---
            useEffect(() => {
                try {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();
                    
                    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —é–∑–µ—Ä–∞
                    if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                        setUser(tg.initDataUnsafe.user);
                    } else {
                        // –î–ª—è —Ç–µ—Å—Ç–æ–≤ –≤ –±—Ä–∞—É–∑–µ—Ä–µ (—Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–æ–∫—É)
                         setUser({ first_name: 'Sani Admin', id: 777, username: ADMIN_USERNAME }); 
                        // setUser({ first_name: 'Test User', id: 999 }); // –ë–µ–∑ —é–∑–µ—Ä–Ω–µ–π–º–∞
                    }

                    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ JSON (–∑–∞—â–∏—Ç–∞ –æ—Ç —Å–±–æ–µ–≤ localStorage)
                    const safeParse = (key, fallback) => {
                        try {
                            const item = localStorage.getItem(key);
                            return item ? JSON.parse(item) : fallback;
                        } catch (e) {
                            console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –ø–∞–º—è—Ç–∏:", e);
                            return fallback;
                        }
                    };

                    const savedConfig = safeParse('app_config', null);
                    if (savedConfig) setConfig(savedConfig);

                    const savedTokens = localStorage.getItem('user_tokens');
                    if (savedTokens) {
                        setTokens(parseInt(savedTokens));
                    } else {
                        // –ï—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥ –µ—Å—Ç—å, –±–µ—Ä–µ–º –±–æ–Ω—É—Å, –∏–Ω–∞—á–µ 100
                        const bonus = savedConfig ? savedConfig.welcomeBonus : 100;
                        setTokens(bonus);
                    }

                    const savedRefs = localStorage.getItem('user_referrals');
                    if (savedRefs) setReferrals(parseInt(savedRefs));

                } catch (err) {
                    console.error("–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:", err);
                    // –ù–µ –±–ª–æ–∫–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ–º
                }
            }, []);

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
            useEffect(() => { localStorage.setItem('user_tokens', tokens); }, [tokens]);
            useEffect(() => { localStorage.setItem('user_referrals', referrals); }, [referrals]);
            useEffect(() => { localStorage.setItem('app_config', JSON.stringify(config)); }, [config]);

            // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω–∞ (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç null)
            const isAdmin = () => {
                if (!user || !user.username) return false;
                return user.username.toLowerCase() === ADMIN_USERNAME.toLowerCase();
            };

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
            const [genType, setGenType] = useState('image');
            const [prompt, setPrompt] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [resultMedia, setResultMedia] = useState(null);

            const handleGenerate = () => {
                const price = genType === 'image' ? config.priceImage : config.priceVideo;
                if (tokens < price) return window.Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!");
                if (!prompt) return;

                setTokens(t => t - price);
                setIsProcessing(true);
                setResultMedia(null);

                setTimeout(() => {
                    setIsProcessing(false);
                    if (genType === 'image') setResultMedia(`https://placehold.co/600x600/1a1a1a/FFF.png?text=${encodeURIComponent(prompt)}`);
                    else setResultMedia("https://media.giphy.com/media/l41lI4bYmcsPJX9Nk/giphy.gif");
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                }, 2000);
            };

            // –ß–∞—Ç
            const [chatInput, setChatInput] = useState('');
            const chatEndRef = useRef(null);

            const handleSendChat = () => {
                if (tokens < config.priceText) return window.Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!");
                if (!chatInput.trim()) return;

                setTokens(t => t - config.priceText);
                const userMsg = { role: 'user', text: chatInput };
                setChatHistory(prev => [...prev, userMsg]);
                setChatInput('');
                
                setTimeout(() => {
                    const aiMsg = { role: 'ai', text: `–ì—Ä–æ–∫: "${userMsg.text}" - –ø—Ä–∏–Ω—è—Ç–æ.` };
                    setChatHistory(prev => [...prev, aiMsg]);
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }, 1000);
            };
            
            useEffect(() => { 
                if(chatEndRef.current) chatEndRef.current.scrollIntoView({ behavior: "smooth" }); 
            }, [chatHistory]);

            // –†–µ—Ñ–µ—Ä–∞–ª—ã
            const inviteLink = `https://t.me/Ai_Generator75_Bot?start=${user.id || 0}`;
            const copyLink = () => {
                navigator.clipboard.writeText(inviteLink);
                window.Telegram.WebApp.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            };
            
            const simInvite = () => {
                setReferrals(r => r + 1);
                if ((referrals + 1) % config.friendsForReward === 0) {
                    setTokens(t => t + config.referralReward);
                    window.Telegram.WebApp.showAlert(`–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –¥—Ä—É–≥–∞! +${config.referralReward} —Ç–æ–∫.`);
                }
            };

            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
            const TabGenerate = () => (
                <div className="page-enter p-4 pb-24">
                    <div className="flex bg-gray-800 rounded-lg p-1 mb-6">
                        <button onClick={() => setGenType('image')} className={`flex-1 py-2 rounded text-sm font-bold ${genType === 'image' ? 'bg-blue-600' : 'text-gray-400'}`}>–ö–∞—Ä—Ç–∏–Ω–∫–∞ ({config.priceImage}—Ç)</button>
                        <button onClick={() => setGenType('video')} className={`flex-1 py-2 rounded text-sm font-bold ${genType === 'video' ? 'bg-purple-600' : 'text-gray-400'}`}>–í–∏–¥–µ–æ ({config.priceVideo}—Ç)</button>
                    </div>
                    <textarea value={prompt} onChange={e => setPrompt(e.target.value)} placeholder="–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ —Å–æ–∑–¥–∞—Ç—å..." className="w-full bg-gray-800 rounded-xl p-4 mb-4 text-white min-h-[120px] border border-gray-700 focus:border-blue-500 outline-none"></textarea>
                    <button onClick={handleGenerate} disabled={isProcessing} className="w-full bg-blue-600 py-4 rounded-xl font-bold shadow-lg active:scale-95 transition-transform flex justify-center items-center">
                        {isProcessing ? <i className="fas fa-spinner fa-spin"></i> : <span>üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</span>}
                    </button>
                    {resultMedia && <div className="mt-6 rounded-xl overflow-hidden border border-gray-700 animate-fade-in"><img src={resultMedia} className="w-full" /></div>}
                </div>
            );

            const TabChat = () => (
                <div className="page-enter flex flex-col h-[calc(100vh-80px)]">
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                        {chatHistory.map((msg, idx) => (
                            <div key={idx} className={`flex flex-col ${msg.role === 'user' ? 'items-end' : 'items-start'}`}><div className={`message-bubble ${msg.role === 'user' ? 'user-msg' : 'ai-msg'}`}>{msg.text}</div></div>
                        ))}
                        <div ref={chatEndRef} />
                    </div>
                    <div className="p-3 bg-gray-900 border-t border-gray-800 flex items-center gap-2">
                        <input value={chatInput} onChange={e => setChatInput(e.target.value)} placeholder={`–í–æ–ø—Ä–æ—Å (${config.priceText}—Ç)...`} className="flex-1 bg-gray-800 text-white rounded-full px-4 py-2 outline-none border border-gray-700" />
                        <button onClick={handleSendChat} className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white"><i className="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            );

            const TabProfile = () => (
                <div className="page-enter p-4 pb-24">
                    <div className="bg-gray-800 rounded-2xl p-6 mb-6 border border-gray-700">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h2 className="text-xl font-bold">{user.first_name || 'User'}</h2>
                                {/* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞, –µ—Å–ª–∏ –Ω–µ—Ç —é–∑–µ—Ä–Ω–µ–π–º–∞ */}
                                <p className="text-gray-400 text-sm">@{user.username || '–Ω–µ—Ç_–Ω–∏–∫–∞'}</p>
                            </div>
                            <div className="text-right"><span className="block text-3xl font-bold text-yellow-500">{tokens}</span><span className="text-xs text-gray-400">TOKENS</span></div>
                        </div>
                        {isAdmin() && (
                            <button onClick={() => setActiveTab('admin')} className="w-full bg-red-900/50 text-red-200 py-2 rounded-lg text-sm mb-4 border border-red-800">‚öôÔ∏è –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∞</button>
                        )}
                        <div className="grid grid-cols-2 gap-3">
                            <div className="bg-gray-700/30 p-3 rounded-xl text-center"><p className="text-xs text-gray-400">–î—Ä—É–∑–µ–π</p><p className="font-bold">{referrals}</p></div>
                            <div className="bg-gray-700/30 p-3 rounded-xl text-center"><p className="text-xs text-gray-400">ID</p><p className="font-bold text-xs">{user.id}</p></div>
                        </div>
                    </div>
                    <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                        <h3 className="font-bold mb-2">üéÅ –†–µ—Ñ–µ—Ä–∞–ª–∫–∞</h3>
                        <p className="text-sm text-gray-400 mb-4">–ù–∞–≥—Ä–∞–¥–∞: {config.referralReward} —Ç.</p>
                        <div className="bg-black/30 p-3 rounded-lg flex justify-between mb-4"><code className="text-xs text-blue-300 truncate max-w-[200px]">{inviteLink}</code><button onClick={copyLink} className="text-blue-500 text-xs font-bold">COPY</button></div>
                        <button onClick={simInvite} className="w-full border border-dashed border-gray-600 py-2 text-xs text-gray-500">–°–∏–º—É–ª—è—Ü–∏—è –¥—Ä—É–≥–∞ (+1)</button>
                    </div>
                </div>
            );

            const TabAdmin = () => (
                <div className="page-enter p-4 pb-24">
                    <button onClick={() => setActiveTab('profile')} className="mb-4 text-gray-400"><i className="fas fa-arrow-left"></i> –ù–∞–∑–∞–¥</button>
                    <h2 className="text-xl font-bold text-red-400 mb-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                    <div className="space-y-4">
                        <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                            <h3 className="text-xs font-bold text-gray-500 mb-3 uppercase">–¶–µ–Ω—ã</h3>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-xs text-gray-500">–ö–∞—Ä—Ç–∏–Ω–∫–∞</label><input type="number" value={config.priceImage} onChange={e => setConfig({...config, priceImage: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                                <div><label className="text-xs text-gray-500">–í–∏–¥–µ–æ</label><input type="number" value={config.priceVideo} onChange={e => setConfig({...config, priceVideo: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                                <div><label className="text-xs text-gray-500">–ß–∞—Ç</label><input type="number" value={config.priceText} onChange={e => setConfig({...config, priceText: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                            </div>
                        </div>
                        <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                            <h3 className="text-xs font-bold text-gray-500 mb-3 uppercase">–ë–æ–Ω—É—Å—ã</h3>
                            <div><label className="text-xs text-gray-500">–°—Ç–∞—Ä—Ç–æ–≤—ã–π –±–æ–Ω—É—Å</label><input type="number" value={config.welcomeBonus} onChange={e => setConfig({...config, welcomeBonus: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                            <div className="mt-2"><label className="text-xs text-gray-500">–ó–∞ –¥—Ä—É–≥–∞</label><input type="number" value={config.referralReward} onChange={e => setConfig({...config, referralReward: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                        </div>
                    </div>
                </div>
            );

            const NavItem = ({ id, icon, label }) => (
                <button onClick={() => setActiveTab(id)} className={`flex flex-col items-center space-y-1 w-16 ${activeTab === id ? 'text-blue-500 scale-110' : 'text-gray-500'}`}>
                    <i className={`fas ${icon} text-xl`}></i><span className="text-[10px] font-medium">{label}</span>
                </button>
            );

            return (
                <div className="min-h-screen bg-[#17212b]">
                    {activeTab === 'generate' && <TabGenerate />}
                    {activeTab === 'chat' && <TabChat />}
                    {activeTab === 'profile' && <TabProfile />}
                    {activeTab === 'admin' && <TabAdmin />}
                    <div className="fixed bottom-0 left-0 right-0 bg-[#1c2936] border-t border-gray-800 pb-safe pt-2 px-6 flex justify-around z-40 h-[70px]">
                        <NavItem id="generate" icon="fa-wand-magic-sparkles" label="–ò–º–∏–¥–∂" />
                        <NavItem id="chat" icon="fa-comments" label="–ß–∞—Ç" />
                        <NavItem id="profile" icon="fa-user-astronaut" label="–ü—Ä–æ—Ñ–∏–ª—å" />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


